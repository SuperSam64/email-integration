<html>
	<head>
		<title>Filters Fast</title>
		<link href="https://integrations.missiveapp.com/missive.css" rel="stylesheet">
		<link href="profile-visibility.css" rel="stylesheet">
		<link href="test/style_test.css" rel="stylesheet">
		<script src="https://integrations.missiveapp.com/missive.js"></script>
		<script src="test/script_test.js"></script>
	</head>
	<body style="width:98%;height:96%;margin:auto">
		<!---------------------------HEADER--------------------------------->
		<div style="top:0px;left:0px;margin:0px;padding:0px;width:100%;background-color:var(--missive-background-color)">
		  <div class="column-vertical padding margin section" style="border:1px solid var(--missive-conversation-list-border-color);border-radius:6px;background-color: var(--missive-conversation-list-background-color)">
			<table cellspacing="0" cellpadding="0" style="margin:auto;border:none">
			  <tbody>
				<tr>
				  <td rowspan="2">
					<span id="avatar" style="border:4px solid var(--accent-color);display:block;background-image: url('profileplaceholder.png');height:54px;width:54px;background-size:cover;background-position: center center;border-radius:32px"></span>
				  </td>
				  <td>
					<span id="name" style="margin-left:8px" class="text-xlarge text-600"></span>
				  </td>
				</tr>
				<tr>
				  <td>
					<span id="layout" style="margin-left:8px;vertical-align:top;font-style: italic" class="text-small text-c"></span>
				  </td>
				</tr>
			  </tbody>
			</table>
		  </div>
		</div>
		<!-------------------------- BUTTON -------------------------------------->
		<div style="width:100%;margin:auto"><span class="button column padding testButton" style="text-align:center;width:46%;margin-left:2%;margin-right:1%;margin-top:2%" id="button1">Cancellation (Reply)</span>
			<!------------------------------------------------------------------------>
			<!-------------------------- BUTTON -------------------------------------->
			<span class="button column padding testButton" style="text-align:center;width:46%;margin-left:1%;margin-right:2%;margin-top:2%" id="button2">Cancellation (New)</span></div>
		<!------------------------------------------------------------------------>
		<!-------------------------- BUTTON -------------------------------------->
		<span class="button column padding testButton" id="button3" style="visibility:hidden">Insert Signature</span><br>
		<!------------------------------------------------------------------------>
		<!-------------------------- BUTTON -------------------------------------->
		<span class="button column padding testButton" id="button4" style="visibility:hidden">Insert Tasks</span><br>
		<!------------------------------------------------------------------------>
		<!-------------------------- BUTTON -------------------------------------->
		<span class="button column padding testButton" id="button5" style="visibility:hidden">Insert Reply Draft</span><br>
		<!------------------------------------------------------------------------>
		<!-------------------------- BUTTON -------------------------------------->
		<span class="button column padding testButton" id="button6" style="visibility:hidden">Save Contact</span><br>
		<!------------------------------------------------------------------------>
		<table class="textFrame" style="visibility:hidden"> <!-- Table of results -->
		<!------------------------- TEXT BOX -------------------------->
		<span id="title1" class="textTitle" style="visibility:hidden"></span>
		</span><span id="body1" class="textBody" style="visibility:hidden">
		  </span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title2" class="textTitle" style="visibility:hidden"></span>
	
		  </span><span id="body2" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title3" class="textTitle" style="visibility:hidden"></span>
			
		  </span><span id="body3" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title4" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body4" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title5" class="textTitle" style="visibility:hidden"></span>
	
		  </span><span id="body5" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title6" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body6" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title7" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body7" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title8" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body8" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title9" class="textTitle" style="visibility:hidden"></span>
	
		  </span><span id="body9" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title10" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body10" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title11" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body11" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title12" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body12" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title13" class="textTitle" style="visibility:hidden"></span>
	
		  </span><span id="body13" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title14" class="textTitle" style="visibility:hidden"></span>
	
		  </span><span id="body14" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title15" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body15" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title16" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body16" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		  <span id="title17" class="textTitle" style="visibility:hidden"></span>
		
		  </span><span id="body17" class="textBody" style="visibility:hidden">
			</span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		<span id="title18" class="textTitle" style="visibility:hidden"></span>
		
		</span><span id="body18" style="visibility:hidden" class="textBody bottomSection">
		  </span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		<span id="title19" class="textTitle" style="visibility:hidden"></span>
		 
		</span><span id="body19" style="visibility:hidden" class="textBody bottomSection" style="visibility:hidden">
		  </span>
		<!------------------------------------------------------------->
		<!------------------------- TEXT BOX -------------------------->
		<span id="title19" class="textTitle" style="visibility:hidden"></span>
	
		</span><span id="body20" style="visibility:hidden" class="textBody bottomSection">
		  </span>
		<!------------------------------------------------------------->
		</table>
		<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
		<script type="text/javascript">
		  {//---- VARIABLES ----
			var currentUser;
			var fullName;
			var profileType = "CCA"; // CCA, CRM, master
			var title = "Customer Care Advocate" // default, unless  otherwise specified
			var crmList = ["fd1f7da207de","a50d68b28cfd","cc4c53720ddf","37e9dbc091a3","f77b171dc34c"]; // (Gema, Isabel, Kaitlyn, Kylee, Alli)
			var adminList = ["dfbf5285907d","eebc81b9f454","aaa5d13aaeb2"] // (Sam, David, Amelia)
			var currentConversation;
			var conversationID;
			var conversationCount;
			var messageTo;
			var messageFrom;
			var customerName;
			var messageSubject;
			var conversationSubject;
			var userAssigned;
			var assignDraft;
			var forwarded;
			var conversationLink;
			var messageLink;
			var labels;
			var isLabeled;
			var preview;
			var fullMessage;
			var orderNoTest = "Order #CP-12458935"; // this is for testing, delete later
			var orderNumber;
			var signature;
			var emailClosing = "Sincerely";
			var suggestedLabel;
			var timeStamp;
			var token;
			var replied;
			var intro;
			var greeting;
			var lastReceived;
			var purchaseOrderTasks = [
			  "Email customer for PO revision",
			  "PO prepared",
			  "Customer is on terms (Limit: $)",
			  "- or - Email customer that order needs payment",
			  "Take payment",
			  "Send confirmation email",
			  "Sending shippng info to [DC](https://filtersfast.monday.com/boards/768866444) | [Purchasing](https://filtersfast.monday.com/boards/768866444)"
			]
		  }
		  // ============ PAGE LOAD ==============
		  $(window).on('load',(ids) => {
			Missive.fetchUsers().then((users) => {
			  $(users).each(function(){
				if(this.me){
					currentUser = this;
			  }
			});
			$(adminList).each(function(){
				if(this == currentUser.id.split("-")[4]){
				  profileType = "master"
				  title = "Administrator";
				}
			});
			$(crmList).each(function(){
				if(this == currentUser.id.split("-")[4]){
				  profileType = "CRM"
				  title = "Client Relationship Manager";
				}
			});
			var fullName = currentUser.first_name + " " + currentUser.last_name;
			$("#avatar").css("background-image","url(" + currentUser.avatar_url + ")");
			$("#name").text(fullName);
			$("#layout").text(title);
			});
			Missive.fetchLabels().then((labels) => {
			  var organization
			  $(labels).each(function(){
				if(this.id.length == 36){
					organization = this.organization_id;
				}
			  });
			  token = getKey(organization);
			  contactBook = getContactsKey(organization);
			  $("#body19").text(token + " | " + contactBook);  // this can be deleted later, it is only used to show the key
			});
			Missive.fetchConversations(ids).then((conversations) => {		
			  currentConversation = conversations[0];
			  update(currentConversation);
			  showResults();
			})				
		  });
		  // =====================================
		  //------- WHEN CONVERSATION CHANGES ---------
		  Missive.on('change:conversations', (ids) => {
					Missive.fetchConversations(ids).then((conversations) => {		
			  currentConversation = conversations[0];
			  update(currentConversation);
			  showResults();
					})
				})
		  {//---------------- RESETS ------------------
		  $("#title1").click(function () { 
			body1Reset();
		  });
		  $("#body1").click(function () { 
			body1Reset();
		  });
		  $("#title2").click(function () { 
			body2Reset();
		  });
		  $("#body2").click(function () { 
			body2Reset();
		  });
		  $("#title3").click(function () { 
			body3Reset();
		  });
		  $("#body3").click(function () { 
			body3Reset();
		  });
		  $("#title4").click(function () { 
			body4Reset();
		  });
		  $("#body4").click(function () { 
			body4Reset();
		  });
		  $("#title5").click(function () { 
			body5Reset();
		  });
		  $("#body5").click(function () { 
			body5Reset();
		  });
		  $("#title6").click(function () { 
			body6Reset();
		  });
		  $("#body6").click(function () { 
			body6Reset();
		  });
		  $("#title7").click(function () { 
			body7Reset();
		  });
		  $("#body7").click(function () { 
			body7Reset();
		  });
		  $("#title8").click(function () { 
			body8Reset();
		  });
		  $("#body8").click(function () { 
			body8Reset();
		  });
		  $("#title9").click(function () { 
			body9Reset();
		  });
		  $("#body9").click(function () { 
			body9Reset();
		  });
		  $("#title10").click(function () { 
			body10Reset();
		  });
		  $("#body10").click(function () { 
			body10Reset();
		  });
		  $("#title11").click(function () { 
			body11Reset();
		  });
		  $("#body11").click(function () { 
			body11Reset();
		  });
		  $("#title12").click(function () { 
			body12Reset();
		  });
		  $("#body12").click(function () { 
			body12Reset();
		  });
		  $("#title13").click(function () { 
			body13Reset();
		  });
		  $("#body13").click(function () { 
			body13Reset();
		  });
		  $("#title14").click(function () { 
			body14Reset();
		  });
		  $("#body14").click(function () { 
			body14Reset();
		  });
		  $("#body15").click(function () { 
			body15Reset();
		  });
		  $("#body16").click(function () { 
			body16Reset();
		  });
		  $("#body17").click(function () { 
			body17Reset();
		  });
		  $("#body18").click(function () { 
			body18Reset();
		  });
		  $("#body19").click(function () { 
			body19Reset();
		  });
		  $("#body20").click(function () { 
			body20Reset();
		  });
		  $("#button1").click(function () { 
			button1Clicked();
		  });
		  $("#button2").click(function () { 
			button2Clicked();
		  });
		  $("#button3").click(function () { 
			button3Clicked();
		  });
		  $("#button4").click(function () { 
			button4Clicked();
		  });
		  $("#button5").click(function () { 
			button5Clicked();
		  });
		  $("#button6").click(function () { 
			button6Clicked();
		  });
		  }
		</script>
	</body>
	</html>