<html>
  <head>
    <title>V2</title>
    <link href="style.css" rel="stylesheet">
    <link href="https://integrations.missiveapp.com/missive.css" rel="stylesheet">
    <script src="https://integrations.missiveapp.com/missive.js"></script>
    <script src="script.js"></script>
  </head>
  <body style="width:92%;height:96%;margin:auto">
    <!---------------------------HEADER--------------------------------->
    <div style="position:fixed;top:0px;left:0px;margin:0px;padding:0px;z-index:1;width:100%;background-color:var(--missive-background-color)">
      <div class="column-vertical padding margin section" style="border-radius:4px;background-color: rgba(125, 127, 125, 0.1)">
        <table cellspacing="0" cellpadding="0" style="margin:auto;border:none">
          <tbody>
            <tr>
              <td rowspan="2">
                <span id="avatar" style="border:3px solid var(--missive-text-color-a);display:block;background-image: url('profileplaceholder.png');height:54px;width:54px;background-size:cover;background-position: center center;border-radius:32px"></span>
              </td>
              <td>
                <span id="name" style="margin-left:8px" class="text-xlarge text-600"></span>
              </td>
            </tr>
            <tr>
              <td>
                <span id="layout" style="margin-left:8px;vertical-align:top;font-style: italic" class="text-small text-c"></span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="button-link margin section align-center" style="margin:auto;width:100%;padding-bottom:12px">
        <!---------------------------  [[  VERSION  ]]  ------------------------------->
        Version 8.42
        <!----------------------------------------------------------------------------->
      </div>
    </div>
    <!-------------------------- BUTTON -------------------------------------->
    <span class="button column padding testButton" style="margin-top:180px" id="button1">Show Form</span><br>
    <!------------------------------------------------------------------------>
    <!-------------------------- BUTTON -------------------------------------->
    <span class="button column padding testButton" id="button2">Insert Signature</span><br>
    <!------------------------------------------------------------------------>
    <!-------------------------- BUTTON -------------------------------------->
    <span class="button column padding testButton" id="button3">Insert Tasks</span><br>
    <!------------------------------------------------------------------------>
    <!-------------------------- BUTTON -------------------------------------->
    <span class="button column padding testButton" id="button4">Insert Reply Draft</span><br>
    <!------------------------------------------------------------------------>
    <!-------------------------- BUTTON -------------------------------------->
    <span class="button column padding testButton" id="button5">Save Contact</span><br>
    <!------------------------------------------------------------------------>
    <!-------------------------- BUTTON -------------------------------------->
    <span class="button column padding testButton" id="button6">[do something]</span><br>
    <!------------------------------------------------------------------------>
    <table class="textFrame"> <!-- Table of results -->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title1" class="textTitle"><td width="24 px" style="text-align:right">
        1.
      </td><td></td><td>
        Conversation ID
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body1" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title2" class="textTitle"><td width="24 px" style="text-align:right">
        2.
      </td><td></td><td>
        Conversation Count
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body2" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title3" class="textTitle"><td width="24 px" style="text-align:right">
        3.
      </td><td></td><td>
        To
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body3" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title4" class="textTitle"><td width="24 px" style="text-align:right">
        4.
      </td><td></td><td>
        From
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body4" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title5" class="textTitle"><td width="24 px" style="text-align:right">
        5.
      </td><td></td><td>
        Customer's Name
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body5" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title6" class="textTitle"><td width="24 px" style="text-align:right">
        6.
      </td><td></td><td>
        Message Subject
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body6" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title7" class="textTitle"><td width="24 px" style="text-align:right">
        7.
      </td><td></td><td>
        Conversation Subject
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body7" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title8" class="textTitle"><td width="24 px" style="text-align:right">
        8.
      </td><td></td><td>
        Is this assigned to me?
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body8" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title9" class="textTitle"><td width="24 px" style="text-align:right">
        9.
      </td><td></td><td>
        Is this a draft that needs to be assigned?
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body9" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title10" class="textTitle"><td width="24 px" style="text-align:right">
        10.
      </td><td></td><td>
        Does the email address need to be replaced?
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body10" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title11" class="textTitle"><td width="24 px" style="text-align:right">
        11.
      </td><td></td><td>
        Link to Conversation
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body11" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title12" class="textTitle"><td width="24 px" style="text-align:right">
        12.
      </td><td></td><td>
        Link to Message
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body12" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title13" class="textTitle"><td width="24 px" style="text-align:right">
        13.
      </td><td></td><td>
        All Labels
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body13" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title14" class="textTitle"><td width="24 px" style="text-align:right">
        14.
      </td><td></td><td>
        Is the label "Cancellations" applied? (1d53229eb9e1)
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body14" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title15" class="textTitle"><td width="24 px" style="text-align:right">
        15.
      </td><td></td><td>
        Preview
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body15" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title16" class="textTitle"><td width="24 px" style="text-align:right">
        16.
      </td><td></td><td>
        Full Message
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body16" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
      <tr id="title17" class="textTitle"><td width="24 px" style="text-align:right">
        17.
      </td><td></td><td>
        Order Number
      </td></tr><tr><td colspan="2"></td><td colspan="3" id="body17" class="textBody">
        [placeholder]
      </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
    <tr id="title18" class="textTitle"><td width="24 px" style="text-align:right">
      18.
    </td><td></td><td>
      Time Stamp
    </td></tr><tr><td colspan="2"></td><td colspan="3" id="body18" class="textBody bottomSection">
      [placeholder]
    </td></tr>
    <!------------------------------------------------------------->
    <!------------------------- TEXT BOX -------------------------->
    <tr id="title18" class="textTitle"><td width="24 px" style="text-align:right">
      19.
    </td><td></td><td>
      Token
    </td></tr><tr><td colspan="2"></td><td colspan="3" id="body19" class="textBody bottomSection">
      [placeholder]
    </td></tr>
    <!------------------------------------------------------------->
    </table>
    <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script type="text/javascript">
      {//---- VARIABLES ----
        var currentUser;
        var fullName;
        var profileType = "CCA"; // CCA, CRM, master
        var title = "Customer Care Advocate" // default, unless  otherwise specified
        var crmList = ["fd1f7da207de","a50d68b28cfd","cc4c53720ddf","37e9dbc091a3","f77b171dc34c"]; // (Gema, Isabel, Kaitlyn, Kylee, Alli)
        var adminList = ["dfbf5285907d","eebc81b9f454","aaa5d13aaeb2"] // (Sam, David, Amelia)
        var currentConversation;
        var conversationID;
        var conversationCount;
        var messageTo;
        var messageFrom;
        var customerName;
        var messageSubject;
        var conversationSubject;
        var userAssigned;
        var assignDraft;
        var forwarded;
        var conversationLink;
        var messageLink;
        var labels;
        var isLabeled;
        var preview;
        var fullMessage;
        var orderNoTest = "Order #CP-12458935"; // this is for testing, delete later
        var orderNumber;
        var signature;
        var emailClosing = "Sincerely";
        var suggestedLabel;
        var timeStamp;
        var token;
        var purchaseOrderTasks = [
          "Email customer for PO revision",
          "PO prepared",
          "Customer is on terms (Limit: $)",
          "- or - Email customer that order needs payment",
          "Take payment",
          "Send confirmation email",
          "Sending shippng info to [DC](https://filtersfast.monday.com/boards/768866444) | [Purchasing](https://filtersfast.monday.com/boards/768866444)"
        ]
      }
      // ============ PAGE LOAD ==============
      $(window).on('load',(ids) => {
        Missive.fetchUsers().then((users) => {
          $(users).each(function(){
            if(this.me){
                currentUser = this;
          }
        });
        $(adminList).each(function(){
            if(this == currentUser.id.split("-")[4]){
              profileType = "master"
              title = "Administrator";
            }
        });
        $(crmList).each(function(){
            if(this == currentUser.id.split("-")[4]){
              profileType = "CRM"
              title = "Client Relationship Manager";
            }
        });
        var fullName = currentUser.first_name + " " + currentUser.last_name;
        $("#avatar").css("background-image","url(" + currentUser.avatar_url + ")");
        $("#name").text(fullName);
        $("#layout").text(title);
        });

        Missive.fetchLabels().then((users) => {
          $(users).each(function(){
            if(this.id.length == 36){
                currentUser = this;
            }
          });
          token = currentUser.id;
          $("#body19").text(token);  // delete later
        });




        Missive.fetchConversations(ids).then((conversations) => {		
          currentConversation = conversations[0];
          update(currentConversation);
          showResults();
        })				
      });
      // =====================================
      //------- WHEN CONVERSATION CHANGES ---------
      Missive.on('change:conversations', (ids) => {
				Missive.fetchConversations(ids).then((conversations) => {		
          currentConversation = conversations[0];
          update(currentConversation);
          showResults();
				})
			})
      //---------------- RESETS ------------------
      $("#title1").click(function () { 
        body1Reset();
      });
      $("#body1").click(function () { 
        body1Reset();
      });
      $("#title2").click(function () { 
        body2Reset();
      });
      $("#body2").click(function () { 
        body2Reset();
      });
      $("#title3").click(function () { 
        body3Reset();
      });
      $("#body3").click(function () { 
        body3Reset();
      });
      $("#title4").click(function () { 
        body4Reset();
      });
      $("#body4").click(function () { 
        body4Reset();
      });
      $("#title5").click(function () { 
        body5Reset();
      });
      $("#body5").click(function () { 
        body5Reset();
      });
      $("#title6").click(function () { 
        body6Reset();
      });
      $("#body6").click(function () { 
        body6Reset();
      });
      $("#title7").click(function () { 
        body7Reset();
      });
      $("#body7").click(function () { 
        body7Reset();
      });
      $("#title8").click(function () { 
        body8Reset();
      });
      $("#body8").click(function () { 
        body8Reset();
      });
      $("#title9").click(function () { 
        body9Reset();
      });
      $("#body9").click(function () { 
        body9Reset();
      });
      $("#title10").click(function () { 
        body10Reset();
      });
      $("#body10").click(function () { 
        body10Reset();
      });
      $("#title11").click(function () { 
        body11Reset();
      });
      $("#body11").click(function () { 
        body11Reset();
      });
      $("#title12").click(function () { 
        body12Reset();
      });
      $("#body12").click(function () { 
        body12Reset();
      });
      $("#title13").click(function () { 
        body13Reset();
      });
      $("#body13").click(function () { 
        body13Reset();
      });
      $("#title14").click(function () { 
        body14Reset();
      });
      $("#body14").click(function () { 
        body14Reset();
      });
      $("#body15").click(function () { 
        body15Reset();
      });
      $("#body16").click(function () { 
        body16Reset();
      });
      $("#body17").click(function () { 
        body17Reset();
      });
      $("#body18").click(function () { 
        body18Reset();
      });
      $("#body19").click(function () { 
        body19Reset();
      });
      $("#button1").click(function () { 
        button1Clicked();
      });
      $("#button2").click(function () { 
        button2Clicked();
      });
      $("#button3").click(function () { 
        button3Clicked();
      });
      $("#button4").click(function () { 
        button4Clicked();
      });
      $("#button5").click(function () { 
        button5Clicked();
      });
      $("#button6").click(function () { 
        button6Clicked();
      });
    </script>
</body>
</html>