<html>
	<head>
		<title>Filters Fast</title>
		<script src="https://integrations.missiveapp.com/missive.js"></script>
		<link href="https://integrations.missiveapp.com/missive.css" rel="stylesheet">
	</head>
	<body>
		<table class="section columns-center margin">
			<tr class="section columns-center">
				<td width="120px"><div id="checkmark-text">Chatbot request 1</div></td>
				<td><input type="checkbox" class="checkmark" id="check-toggle"></input></td>
			</tr>
			<tr class="section columns-center">
				<td width="120px"><div id="switch-text" class="columns align-right"></div></td>
				<td><input type="checkbox" class="switch columns" id="check-switch"></input></td>
			</tr>
		</table>
		<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
		<script type="text/javascript">
			var switchOn = "Switch is on V29";
			var switchOff = "Switch is off V29";
			$('#check-toggle').change(function() {
   				if(this.checked){
					Missive.addLabels("32cb35ef-c362-411d-97b5-0d0bb5366d5c");
				}
				if(!this.checked){
					Missive.removeLabels("32cb35ef-c362-411d-97b5-0d0bb5366d5c");
				}
			});
			$( window ).on( "load", function() {
				$('#switch-text').text(switchOff);
			})
			$("#check-switch").click(function () {
				$('#switch-text').text(function(i, text){
          			return text === switchOff ? switchOn : switchOff;
      				})
   			});


			Missive.on('change:conversations', (ids) => {
				Missive.fetchConversations(ids).then((conversations) => {
    				var message = conversations[0].labels[0]
    					if (message === "32cb35ef-c362-411d-97b5-0d0bb5366d5c") {
      						$('#check-toggle').checked();
					}
					else {
      						$('#check-toggle').prop('checked', false);
					}
				}
    			}

    var from = message.from_field
    console.log('Message from:', from.name, from.address)
    console.log('Message subject:', message.subject)
  })
})





			
		</script>
	</body>
</html>
